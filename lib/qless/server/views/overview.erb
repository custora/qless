<% if queues.empty? %>
  <div class="page-header">
    <h1>No Queues</h1>
  </div>
<% else %>
  <div class="page-header">
    <h1>Queues</h1>
  </div>

  <table class="table">
    <thead>
      <tr>
        <th></th>
        <th>running</th>
        <th>waiting</th>
        <th>scheduled</th>
        <th>stalled</th>
        <th>depends</th>
        <th>recurring</th>
      </tr>
    </thead>
    <tbody>
    <% queues.each do |queue| %>
    <tr class="queue-row">
      <td class="queue-column large-text">
        <% if queue['paused'] %>
          <button
            id="<%= queue['name'] %>-pause"
            title="Unpause"
            class="btn btn-success"
            onclick="unpause('<%= queue['name'] %>')"><i class="glyphicon glyphicon-play"></i>
          </button>
        <% else %>
          <button
            id="<%= queue['name'] %>-pause"
            title="Pause"
            class="btn btn-warning"
            onclick="pause('<%= queue['name'] %>')"><i class="glyphicon glyphicon-pause"></i>
          </button>
        <% end %>
        <a href="<%= u "/queues/#{CGI::escape(queue['name'])}" %>"><%= queue['name'] %></a>
      </td>
      <td><a href="<%= u "/queues/#{CGI::escape(queue['name'])}/running" %>"><%= number_with_delimiter(queue['running']) %></a></td>
      <td><a href="<%= u "/queues/#{CGI::escape(queue['name'])}/waiting" %>"><%= number_with_delimiter(queue['waiting']) %></a></td>
      <td><a href="<%= u "/queues/#{CGI::escape(queue['name'])}/scheduled" %>"><%= number_with_delimiter(queue['scheduled']) %></a></td>
      <td><a href="<%= u "/queues/#{CGI::escape(queue['name'])}/stalled" %>"><%= number_with_delimiter(queue['stalled']) %></a></td>
      <td><a href="<%= u "/queues/#{CGI::escape(queue['name'])}/depends" %>"><%= number_with_delimiter(queue['depends']) %></a></td>
      <td><a href="<%= u "/queues/#{CGI::escape(queue['name'])}/recurring" %>"><%= number_with_delimiter(queue['recurring']) %></a></td>
    </tr>
  <% end %>
  </tbody>
</table>
<% end %>

<% if failed.any? %>
  <div class="page-header">
    <h1>Failed Jobs</h1>
  </div>

  <table class="table">
    <thead>
      <tr>
        <th>failure</th>
        <th>count</th>
      </tr>
    </thead>
    <tbody>
    <% failed.sort_by { |t, count| -count }.each do |t, count| %>
    <tr class="failed-row">
      <td class="large-text"><a href="<%= u "/failed/#{t}" %>"><%= t %></a></td>
      <td><a href="<%= u "/failed/#{t}" %>"><%= number_with_delimiter(count) %></a></td>
    </tr>
    <% end %>
    </tbody>
  </table>
<% end %>

<% if tracked['jobs'].any? %>
  <div class="page-header">
    <h1>Tracked Jobs</h1>
  </div>
  <% counts = Hash.new; tracked['jobs'].each { |job| counts[job.state] ||= 0; counts[job.state] += 1 } %>
  <table class="table">
    <thead>
      <tr>
        <th>state</th>
        <th>count</th>
      </tr>
    </thead>
    <tbody>
    <% counts.sort_by { |state, count| - count }.each do |state, count| %>
    <tr class="tracked-row">
      <td class="large-text"><a href="<%= u "/track##{state}" %>"><%= state %></a></td>
      <td><%= number_with_delimiter(count) %></td>
    </tr>
    <% end %>
    </tbody>
  </table>
<% end %>

<% if workers.any? %>
  <div class="page-header">
    <h1>Current Workers</h1>
  </div>
  <table class="table">
    <thead>
      <tr>
        <th></th>
        <th>running</th>
        <th>stalled</th>
      </tr>
    </thead>
    <tbody>
    <% workers.each do |worker| %>
    <tr class='worker-row'>
      <td class="large-text"><a href="<%= u "/workers/#{worker['name']}" %>"><%= worker['name'] %></a></td>
      <td><%= worker['jobs'] %></td>
      <td><%= worker['stalled'] %></td>
    </tr>
    <% end %>
    </tbody>
  </table>
<% end %>
